// atomic example

import UI/MindstoneButton

var x = null
var xT = null
var x_old = x
var xT_old = xT

var y = null
var yT = null
var y_old = y
var yT_old = yT

var yVal = 0
?foe.state = 4 & foe.time = 0
  yVal++

mainX()
mainY()

func mainX()
  ?initX()
    mkX()
  :?regenX()
    dlX()
    mkX()
  :
    updateX()

func initX()
  return !(x & xT)

func regenX()
  return x ! x_old | xT ! xT_old

func dlX()
  x.Remove(xT)
  xT = null
  x.Recycle()
  x = null
  
  xT_old = xT
  x_old = x

func mkX()
  xT = ui.AddText("t="+totaltime)
  xT.anchor = "center_center"
  xT.dock = "center_center"
  xT.w = string.Size("t="+totaltime)
  xT.h = 1
  xT.align = "center"
  xT.color = color.FromRGB(255,0,0)
  
  x = ui.AddPanel()
  x.x = 1
  x.y = 1
  x.w = xT.w + 2
  x.h = xT.h + 2
  x.anchor = "top_left"
  x.dock = "top_left"
  x.color = color.FromRGB(100,0,0)

  x.Add(xT)
  
func updateX()
  xT.text = "t="+totaltime

/*************************/

func mainY()
  ?initY()
    mkY()
  :?regenY()
    dlY()
    mkY()
  :
    updateY()

func initY()
  return !(y & yT)

func regenY()
  return y ! y_old | yT ! yT_old

func dlY()
  y.Remove(yT)
  yT = null
  y.Recycle()
  y = null
  
  yT_old = yT
  y_old = y

func mkY()
  yT = ui.AddText("kills="+yVal)
  yT.anchor = "center_center"
  yT.dock = "center_center"
  yT.w = string.Size("kills="+yVal)
  yT.h = 1
  yT.align = "center"
  yT.color = color.FromRGB(0,255,0)
  
  y = ui.AddPanel()
  y.x = 1
  y.y = 10
  y.w = yT.w + 2
  y.h = yT.h + 2
  y.anchor = "top_left"
  y.dock = "top_left"
  y.color = color.FromRGB(0,100,0)

  y.Add(yT)

func updateY()
  yT.text = "kills="+yVal